<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Birthday Cake</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(135deg, #ffd6e0 0%, #fff9c4 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: 'Comic Neue', cursive;
    }

    .scene {
      position: relative;
      width: 400px;
      height: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      padding-bottom: 50px;
    }

    .cake-container {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
      margin-bottom: 60px;
    }

    .plate {
      width: 340px;
      height: 30px;
      background: #f0f0f0;
      border-radius: 50%;
      position: relative;
      z-index: 0;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .cake {
      width: 300px;
      height: 180px;
      background: #ff8fab;
      border-radius: 0 0 20px 20px;
      position: relative;
      z-index: 1;
      overflow: hidden;
      cursor: pointer;
      margin-top: 100px;
    }

    .frosting {
      width: 320px;
      height: 70px;
      background: #ffebee;
      border-radius: 50% 50% 0 0;
      position: absolute;
      top: -45px;
      left: -10px;
      z-index: 2;
      box-shadow: 
        inset 0 -10px 20px rgba(255,192,203,0.5),
        0 3px 5px rgba(0,0,0,0.1);
    }
     .frosting-drips {
      position: absolute;
      width: 100%;
      height: 30px;
      top: 25px;
    }

    .drip {
      position: absolute;
      width: 15px;
      height: 25px;
      background: #ffebee;
      border-radius: 0 0 10px 10px;
    }

    .drip:nth-child(1) { left: 30px; height: 20px; }
    .drip:nth-child(2) { left: 70px; height: 25px; }
    .drip:nth-child(3) { left: 120px; height: 18px; }
    .drip:nth-child(4) { left: 180px; height: 22px; }
    .drip:nth-child(5) { left: 230px; height: 25px; }
    .drip:nth-child(6) { left: 270px; height: 20px; }

    .layer {
      width: 100%;
      height: 60px;
      background: #ffb3c6;
      border-top: 3px dashed rgba(255,255,255,0.5);
      position: relative;
      overflow: hidden;
    }

    .sprinkles {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .sprinkle {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .candles {
      display: flex;
      justify-content: center;
      gap: 25px;
      position: absolute;
      z-index: 3;
      width: 100%;
      margin-top: 48.5px;
    }

    .candle {
      width: 14px;
      height: 50px;
      background: linear-gradient(to bottom, #ff5d8f, #ff8fab);
      border-radius: 5px;
      position: relative;
      box-shadow: 0 3px 5px rgba(0,0,0,0.1);
      transform: rotate(0deg);
      animation: sway 3s infinite ease-in-out;
    }

    @keyframes sway {
      0%, 100% { transform: rotate(-1deg); }
      50% { transform: rotate(1deg); }
    }

    .candle:nth-child(2) { animation-delay: 0.5s; }
    .candle:nth-child(3) { animation-delay: 1s; }

    .flame {
      width: 12px;
      height: 20px;
      background: linear-gradient(to top, #ff9e00, #ffea00);
      border-radius: 50% 50% 20% 20%;
      position: absolute;
      top: -20px;
      left: 1px;
      animation: flicker 0.5s infinite alternate;
      box-shadow: 0 0 10px #ff9e00;
      transform-origin: center bottom;
    }

    @keyframes flicker {
      0%, 100% { transform: scale(1) rotate(-2deg); }
      25% { transform: scale(1.1) rotate(0deg); }
      50% { transform: scale(0.9) rotate(2deg); }
      75% { transform: scale(1.05) rotate(-1deg); }
    }

    .flame.off {
      transform: scale(0);
      opacity: 0;
      transition: all 0.3s ease-out;
    }

    .wax-drips {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .wax {
      position: absolute;
      width: 4px;
      background: #ff8fab;
      border-radius: 2px;
    }

    .message {
      position: absolute;
      bottom: -50px;
      color: #ff5d8f;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      width: 100%;
      transition: all 0.3s ease;
    }

    .celebration {
      margin-bottom: 20px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%) scale(0);
      font-size: 52px;
      font-weight: bold;
      color: #ff5d8f;
      text-shadow: 0 0 10px white, 0 0 20px white;
      opacity: 0;
      transition: all 0.5s ease;
      z-index: 100;
      pointer-events: none;
      white-space: nowrap;
    }

    .celebration.show {
      transform: translateX(-50%) scale(1);
      opacity: 1;
    }

    .piece-plate {
      width: 250px;
      height: 150px;
      background: #e0e0e0;
      border-radius: 50%;
      margin-top: 30px; /* Adjusted spacing */
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
     .cake-piece {
      width: 40px;
      height: 30px;
      background: #ffb3c6;
      border-radius: 5px;
      position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 5px;
    }

    .cake-piece:hover {
      transform: scale(1.1);
    }

    .cake-piece.selected {
      animation: come-forward 0.5s forwards;
    }

   @keyframes come-forward {
      0% {
        transform: translateY(0) translateZ(0) scale(1);
      }
      100% {
        transform: translateY(calc(-50vh + 50px)) translateZ(200px) scale(2.5);
      }
    }


    .cake-piece.bitten {
      animation: disappear 0.5s forwards;
    }

    @keyframes disappear {
      0% {
        opacity: 1;
        transform: translateY(-100px) scale(1.5);
      }
      100% {
        opacity: 0;
        transform: translateY(-100px) scale(0);
      }
    }
 .piece-frosting {
      position: absolute;
      width: 100%;
      height: 10px;
      background: #ffebee;
      border-radius: 5px 5px 0 0;
      top: 0;
    }

    .piece-sprinkles {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .smoke {
      position: absolute;
      width: 8px;
      height: 8px;
      background: rgba(200, 200, 200, 0.8);
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
      filter: blur(2px);
    }

    .yummy-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: #ff5d8f;
    font-weight: bold;
    text-shadow: 0 0 10px white;
    opacity: 0;
    transition: all 0.5s;
    z-index: 1001;
    pointer-events: none;
}
     </style>
</head>
<body>
  <div class="scene">
    <div class="cake-container" id="cakeContainer">
      <div class="candles">
        <div class="candle">
          <div class="flame"></div>
          <div class="wax-drips">
            <div class="wax" style="height: 15px; left: 5px; top: 20px;"></div>
          </div>
        </div>
        <div class="candle">
          <div class="flame"></div>
          <div class="wax-drips">
            <div class="wax" style="height: 10px; left: 5px; top: 25px;"></div>
          </div>
        </div>
        <div class="candle">
          <div class="flame"></div>
          <div class="wax-drips">
            <div class="wax" style="height: 20px; left: 5px; top: 15px;"></div>
          </div>
        </div>
      </div>
      <div class="celebration" id="celebration">Happy Birthday! ðŸŽ‚</div>
      <div class="cake" id="cake">
        <div class="frosting">
          <div class="frosting-drips">
            <div class="drip"></div>
            <div class="drip"></div>
            <div class="drip"></div>
            <div class="drip"></div>
            <div class="drip"></div>
            <div class="drip"></div>
          </div>
        </div>
        <div class="layer">
          <div class="sprinkles" id="sprinkles1"></div>
        </div>
        <div class="layer">
          <div class="sprinkles" id="sprinkles2"></div>
        </div>
        <div class="layer">
          <div class="sprinkles" id="sprinkles3"></div>
        </div>
      </div>
      <div class="plate"></div>
      <div class="message" id="message"></div>
    </div>
    <div class="piece-plate" id="piecePlate"></div>
  </div>

  <script>
    // Add random sprinkles
    function addSprinkles(containerId, count) {
      const container = document.getElementById(containerId);
      const colors = ['#ff5d8f', '#ffbe0b', '#3a86ff', '#8338ec', '#ff006e'];
      
      for (let i = 0; i < count; i++) {
        const sprinkle = document.createElement('div');
        sprinkle.className = 'sprinkle';
        sprinkle.style.left = `${Math.random() * 100}%`;
        sprinkle.style.top = `${Math.random() * 100}%`;
        sprinkle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        container.appendChild(sprinkle);
      }
    }

    addSprinkles('sprinkles1', 30);
    addSprinkles('sprinkles2', 20);
    addSprinkles('sprinkles3', 15);

    let listening = false;
    let audioContext;
    let candlesBlown = false;
    const cake = document.getElementById('cake');
    const message = document.getElementById('message');
    const celebration = document.getElementById('celebration');
    const cakeContainer = document.getElementById('cakeContainer');
    const piecePlate = document.getElementById('piecePlate');

    function createSmoke(x, y) {
      const smoke = document.createElement('div');
      smoke.className = 'smoke';
      smoke.style.left = `${x}px`;
      smoke.style.top = `${y}px`;
      
      cakeContainer.appendChild(smoke);
      
      // Animate smoke
      setTimeout(() => {
        smoke.style.opacity = '0.8';
        smoke.style.transform = `translate(${Math.random() * 20 - 10}px, ${-Math.random() * 30 - 10}px) scale(1.5)`;
      }, 10);
      
      setTimeout(() => {
        smoke.style.opacity = '0';
        smoke.style.transform = `translate(${Math.random() * 40 - 20}px, ${-Math.random() * 60 - 30}px) scale(2)`;
      }, 500);
      
      // Remove smoke after animation
      setTimeout(() => {
        smoke.remove();
      }, 1000);
    }
function createCakePiece(x, y) {
    if (!candlesBlown) return;
    
    const piece = document.createElement('div');
    piece.className = 'cake-piece';
    
    // Add frosting and sprinkles to the piece
    const frosting = document.createElement('div');
    frosting.className = 'piece-frosting';
    piece.appendChild(frosting);
    
    const sprinkles = document.createElement('div');
    sprinkles.className = 'piece-sprinkles';
    piece.appendChild(sprinkles);
    
    // Add some sprinkles to the piece
    const colors = ['#ff5d8f', '#ffbe0b', '#3a86ff', '#8338ec', '#ff006e'];
    for (let i = 0; i < 3; i++) {
        const sprinkle = document.createElement('div');
        sprinkle.className = 'sprinkle';
        sprinkle.style.left = `${Math.random() * 100}%`;
        sprinkle.style.top = `${Math.random() * 100}%`;
        sprinkle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        sprinkles.appendChild(sprinkle);
    }

    // Add click handler for eating the piece
    piece.addEventListener('click', function(e) {
        e.stopPropagation();
        
        if (this.classList.contains('selected')) {
            // If already selected (forward), show yummy message and disappear
            const yummyMessage = document.createElement('div');
            yummyMessage.className = 'yummy-message';
            yummyMessage.textContent = 'Yummy! ðŸŽ‚';
            yummyMessage.style.position = 'fixed';
            yummyMessage.style.top = '50%';
            yummyMessage.style.left = '50%';
            yummyMessage.style.transform = 'translate(-50%, -50%)';
            yummyMessage.style.fontSize = '24px';
            yummyMessage.style.color = '#ff5d8f';
            yummyMessage.style.fontWeight = 'bold';
            yummyMessage.style.textShadow = '0 0 10px white';
            yummyMessage.style.opacity = '0';
            yummyMessage.style.transition = 'all 0.5s';
            document.body.appendChild(yummyMessage);

            // Fade in
            setTimeout(() => {
                yummyMessage.style.opacity = '1';
            }, 10);

            // Remove piece
            this.classList.remove('selected');
            this.classList.add('bitten');
            setTimeout(() => {
                this.remove();
            }, 500);

            // Fade out and remove message
            setTimeout(() => {
                yummyMessage.style.opacity = '0';
                setTimeout(() => {
                    yummyMessage.remove();
                }, 500);
            }, 1000);
        } else {
            // If not selected, bring it forward
            this.classList.add('selected');
        }
    });
    
    piecePlate.appendChild(piece);
}
cake.addEventListener('click', (e) => {
      if (!listening && !candlesBlown) {
        startMic();
      } else if (candlesBlown) {
        createCakePiece(
          e.clientX,
          e.clientY
        );
      }
    });

    function startMic() {
      if (listening) return;
      listening = true;

      message.textContent = "";

      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const mic = audioContext.createMediaStreamSource(stream);
          const analyser = audioContext.createAnalyser();
          analyser.fftSize = 256;
          const bufferLength = analyser.frequencyBinCount;
          const dataArray = new Uint8Array(bufferLength);

          mic.connect(analyser);

          function detectBlow() {
            analyser.getByteFrequencyData(dataArray);
            let sum = 0;
            for (let i = 0; i < bufferLength; i++) {
              sum += dataArray[i];
            }
            const volume = sum / bufferLength;

            if (volume > 40) {
              // Create smoke effects
              document.querySelectorAll('.candle').forEach(candle => {
                const rect = candle.getBoundingClientRect();
                const containerRect = cakeContainer.getBoundingClientRect();
                createSmoke(
                  rect.left + rect.width/2 - containerRect.left,
                  rect.top - containerRect.top
                );
              });

              // Extinguish flames
              document.querySelectorAll('.flame').forEach(f => {
                f.classList.add('off');
              });
              
              stream.getTracks().forEach(track => track.stop());
              if (audioContext) audioContext.close();
              
              candlesBlown = true;
              message.textContent = "";
              
              // Show celebration message above the cake
              celebration.classList.add('show');
              setTimeout(() => {
                celebration.classList.remove('show');
              }, 2000);
              
              return;
            }

            requestAnimationFrame(detectBlow);
          }

          detectBlow();
        })
        .catch(err => {
          console.error('Mic access denied:', err);
          message.textContent = "Please allow microphone access to blow out candles";
        });
    }
  </script>
</body>
</html>